# ─── Model Configuration ────────────────────────────────────────────────────
# SAM model variant: vit_b (faster) | vit_h (more accurate, recommended ≥500 pieces)
SAM_MODEL_TYPE=vit_h

# DINOv2 model name (HuggingFace hub)
DINO_MODEL_NAME=facebook/dinov2-base

# ─── Storage ────────────────────────────────────────────────────────────────
# Root path for all per-job namespaced storage
STORAGE_ROOT=./storage

# Max upload size in megabytes
UPLOAD_MAX_MB=50

# ─── Job Store ──────────────────────────────────────────────────────────────
# Backend for job state: memory (dev) | redis (production)
JOB_STORE_BACKEND=memory

# Redis connection URL (only used when JOB_STORE_BACKEND=redis)
REDIS_URL=redis://localhost:6379/0

# Job TTL in seconds when using Redis (default: 24 hours)
JOB_TTL_SECONDS=86400

# ─── Matching Engine ────────────────────────────────────────────────────────
# Confidence threshold below which pieces are flagged for human review
CONFIDENCE_THRESHOLD=0.55

# Number of candidate grid cells to shortlist via CLS coarse filter
# before running expensive spatial correlation. Higher = more accurate,
# slower. Recommended: 30 for 1000-piece puzzles.
COARSE_TOPK=30

# ─── PCA Token Reduction ────────────────────────────────────────────────────
# Enable PCA dimensionality reduction on DINOv2 tokens (768 → PCA_TARGET_DIMS)
# Strongly recommended for puzzles ≥ 500 pieces
ENABLE_PCA_REDUCTION=true

# Target dimensions after PCA reduction
PCA_TARGET_DIMS=128

# ─── Segmentation ───────────────────────────────────────────────────────────
# SAM points per side for automatic mask generation
# Higher = denser prompting, better for small pieces (1000-piece puzzles)
SAM_POINTS_PER_SIDE=64

# SAM predicted IoU threshold
SAM_PRED_IOU_THRESH=0.88

# SAM stability score threshold
SAM_STABILITY_SCORE_THRESH=0.92

# Minimum mask area in pixels (lower for smaller pieces)
SAM_MIN_MASK_AREA=300

# ─── Feature Extraction ─────────────────────────────────────────────────────
# DINOv2 inference batch size (reduce if GPU OOM)
DINO_BATCH_SIZE=16

# ─── Adjacency Refiner ──────────────────────────────────────────────────────
# Maximum local swap iterations (cap for large puzzles)
ADJACENCY_SWAP_MAX_ITER=500

# ─── Logging ────────────────────────────────────────────────────────────────
LOG_LEVEL=INFO

# ─── Server ─────────────────────────────────────────────────────────────────
HOST=0.0.0.0
PORT=8000